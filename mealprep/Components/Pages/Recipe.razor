@page "/recipe"
@rendermode InteractiveServer
@using MealPrep

@inject NavigationManager NavigationManager

<PageTitle>Recipe</PageTitle>

<h3 style="color: #1e90ff;">Add Recipe</h3>

<div class="form-container">
    <label for="recipeName">Recipe Name:</label>
    <input type="text" id="recipeName" @bind="recipeName" />
    <label for="ingredients">Ingredients:</label>
    <div>
        <div class="ingredient-row">
            <label for="amount">Amount:</label> &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp
            <label for="unit">Unit:</label> &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp
            <label for="ingredienName">Ingredient Name:</label>
        </div>
        @foreach (var ingredient in ingredients)
        {
            <div class="ingredient-row">
                <input type="number" placeholder="Amount" @bind="ingredient.Quantity" />
                <input type="text" placeholder="Unit" @bind="ingredient.Unit" />
                <input type="text" placeholder="Ingredient" @bind="ingredient.Name" />
            </div>
        }
    </div>

    <button @onclick="() => AddIngredientToRecipe()">Add Ingredient</button>
    <label for="ingredientName">Ingredient Name:</label>
    <input type="text" id="ingredientName" @bind="ingredient" />

    <label for="unit">Unit of Ingredient:</label>
    <input type="text" id="unit" @bind="unit" />

    <label for="quantity">Quantity:</label>
    <input type="number" id="quantity" @bind="quantity" />

    <button @onclick="() => AddRecipeToDatabase()" type="submit">Add Recipe</button>
</div>


<h3 style="color: #1e90ff;">Add Ingredient</h3>

<div class="form-container">
    <label for="ingredientName">Ingredient Name:</label>
    <input type="text" id="ingredientName" @bind="ingredient" />
    
    <button @onclick="() => AddIngredientToDatabase()" type="submit">Add Ingredient</button>
</div> 

@code {
    private string ingredient;
    private string unit;
    private float quantity;
    private string ?recipeName;
    List<Ingredient> ingredients = new List<Ingredient>();

    private void AddRecipeToDatabase()
    {
        //TODO: check if recipe is valid before you add it to database
        //TODO: add to Table of Recipe
        //TODO: check first table of ingredient for every ingredients to se if Database holds given ingredient
        //TODO: add to table of ingredients
        //TODO: check recipe db for given recipe and use unit and amount for meal juction
        //TODO: add to table of meals
    }
    private void AddIngredientToRecipe()
    {
        ingredients.Add(new Ingredient(ingredient, unit, quantity));
        ingredient = string.Empty;
        unit = string.Empty;
        quantity = 0;
    }

    private void AddIngredientToDatabase()
    {
        try
        {
            //TODO: add a check that searches the db and adds it to db if it does not exists already
            if (!string.IsNullOrEmpty(ingredient))
            {
                var newIngredient = new Ingredient(ingredient);
                DatabaseHelper.addIngredient(newIngredient);
                ingredient = string.Empty;
                // Optionally, you can navigate to another page after adding the ingredient
                //NavigationManager.NavigateTo("/");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error: {ex.Message}");
        }
    }
}

<style>
    .form-container {
        max-width: 400px;
        margin: auto;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        background-color: #f9f9f9;
    }

    label {
        display: block;
        margin-bottom: 5px;
    }

    input {
        width: 100%;
        padding: 8px;
        margin-bottom: 15px;
        box-sizing: border-box;
    }

    .ingredient-row {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
    }

    button {
        background-color: #1e90ff;
        color: white;
        padding: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
</style>